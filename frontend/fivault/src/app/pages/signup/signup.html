<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-md-5 col-lg-4">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h3 i18n="signup page title@@signup-page-title" class="card-title text-center mb-4">Sign Up</h3>

                    <!-- Backend Error Alert -->
                    @if (backendError) {
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        {{ backendError }}
                        <button type="button" class="btn-close" (click)="backendError = ''" aria-label="Close"></button>
                    </div>
                    }

                    <form [formGroup]="signupForm" (ngSubmit)="onSubmit()" novalidate>

                        <!-- Username -->
                        <div class="mb-3">
                            <label i18n="signup form username@@signup-form-username" for="username"
                                class="form-label">Username</label>
                            <input type="username" class="form-control"
                                [class.is-invalid]="username?.invalid && (username?.touched || submitted)"
                                [class.is-valid]="username?.valid && username?.touched" id="username"
                                formControlName="username" placeholder="Enter your username">

                            <!-- username Errors -->
                            @if (username?.invalid && (username?.touched || submitted)) {
                            <div class="invalid-feedback">
                                @if (username?.errors?.['required']) {
                                <div i18n="required field error@@signup-form-required-username-error">Username is
                                    required</div>
                                }
                            </div>
                            }
                        </div>

                        <!-- Email -->
                        <div class="mb-3">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" class="form-control"
                                [class.is-invalid]="email?.invalid && (email?.touched || submitted)"
                                [class.is-valid]="email?.valid && email?.touched" id="email" formControlName="email"
                                placeholder="Enter your email">

                            <!-- Email Errors -->
                            @if (email?.invalid && (email?.touched || submitted)) {
                            <div class="invalid-feedback">
                                @if (email?.errors?.['required']) {
                                <div i18n="required field error@@signup-form-required-email-error">Email is required
                                </div>
                                }
                                @if (email?.errors?.['email']) {
                                <div i18n="valid email error@@signup-form-valid-email-error">Please enter a valid email
                                    address</div>
                                }
                            </div>
                            }
                        </div>

                        <!-- Password -->
                        <div class="mb-3">
                            <label for="password" class="form-label">Password</label>
                            <div class="input-group">
                                <input [type]="showPassword ? 'text' : 'password'" class=" form-control"
                                    [class.is-invalid]="password?.invalid && (password?.touched || submitted)"
                                    [class.is-valid]="password?.valid && password?.touched" id="password"
                                    formControlName="password" placeholder="Create a password">
                                <button class="btn btn-outline-secondary" type="button"
                                    (click)="togglePasswordVisibility()"> <!-- ⬅️ ADDED -->
                                    @if (showPassword) {
                                    <!-- Eye slash icon (hide) -->
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        viewBox="0 0 16 16">
                                        <path
                                            d="M13.359 11.238C15.06 9.72 16 8 16 8s-3-5.5-8-5.5a7.028 7.028 0 0 0-2.79.588l.77.771A5.944 5.944 0 0 1 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.134 13.134 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755-.165.165-.337.328-.517.486l.708.709z" />
                                        <path
                                            d="M11.297 9.176a3.5 3.5 0 0 0-4.474-4.474l.823.823a2.5 2.5 0 0 1 2.829 2.829l.822.822zm-2.943 1.299.822.822a3.5 3.5 0 0 1-4.474-4.474l.823.823a2.5 2.5 0 0 0 2.829 2.829z" />
                                        <path
                                            d="M3.35 5.47c-.18.16-.353.322-.518.487A13.134 13.134 0 0 0 1.172 8l.195.288c.335.48.83 1.12 1.465 1.755C4.121 11.332 5.881 12.5 8 12.5c.716 0 1.39-.133 2.02-.36l.77.772A7.029 7.029 0 0 1 8 13.5C3 13.5 0 8 0 8s.939-1.721 2.641-3.238l.708.709zm10.296 8.884-12-12 .708-.708 12 12-.708.708z" />
                                    </svg>
                                    } @else {
                                    <!-- Eye icon (show) -->
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        viewBox="0 0 16 16">
                                        <path
                                            d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z" />
                                        <path
                                            d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z" />
                                    </svg>
                                    }
                                </button>
                            </div>
                            <!-- Password Errors -->
                            @if (password?.invalid && (password?.touched || submitted)) {
                            <div class="invalid-feedback d-block">
                                @if (password?.errors?.['required']) {
                                <div i18n="required field error@@signup-form-required-password-error">Password is
                                    required</div>
                                }
                                @if (password?.errors?.['minlength']) {
                                <div i18n="password length@@signup-form-password-error-length">Password must be at least
                                    8 characters long</div>
                                }
                                @if (password?.errors?.['passwordStrength']) {
                                <div>Password must contain:</div>
                                <ul class="mb-0 ps-3">
                                    @if (!password?.errors?.['passwordStrength'].hasUpper) {
                                    <li i18n="password error uppercase@@signup-form-password-error-uppercase">At least
                                        one uppercase letter</li>
                                    }
                                    @if (!password?.errors?.['passwordStrength'].hasLower) {
                                    <li i18n="password error lowercase@@signup-form-password-error-lowercase">At least
                                        one lowercase letter</li>
                                    }
                                    @if (!password?.errors?.['passwordStrength'].hasNumber) {
                                    <li i18n="password error numbers@@signup-form-password-error-numbers">At least one
                                        number</li>
                                    }
                                    @if (!password?.errors?.['passwordStrength'].hasSpecial) {
                                    <li i18n="password error strength@@signup-form-password-error-strength">At least one
                                        special character (!@#$%^&*)</li>
                                    }
                                </ul>
                                }
                            </div>
                            }

                            <!-- Password Strength Hints (shown when typing) -->
                            @if (password?.value && password?.touched && !password?.errors?.['required']) {
                            <div class="form-text">
                                <small class="d-block">Password strength:</small>
                                <small i18n="password uppercase@@signup-form-password-uppercase" class="d-block"
                                    [class.text-success]="password?.errors?.['passwordStrength']?.hasUpper ?? true">
                                    ✓ Uppercase letter
                                </small>
                                <small i18n="password lowercase@@signup-form-password-lowercase" class="d-block"
                                    [class.text-success]="password?.errors?.['passwordStrength']?.hasLower ?? true">
                                    ✓ Lowercase letter
                                </small>
                                <small i18n="password numbers@@signup-form-password-numbers" class="d-block"
                                    [class.text-success]="password?.errors?.['passwordStrength']?.hasNumber ?? true">
                                    ✓ Number
                                </small>
                                <small i18n="password strength@@signup-form-password-strength" class="d-block"
                                    [class.text-success]="password?.errors?.['passwordStrength']?.hasSpecial ?? true">
                                    ✓ Special character
                                </small>
                            </div>
                            }
                        </div>

                        <!-- Confirm Password -->
                        <div class="mb-3">
                            <label for="confirmPassword" class="form-label">Confirm Password</label>
                            <div class="input-group">
                                <input [type]="showConfirmPassword ? 'text' : 'password'" class="form-control"
                                    [class.is-invalid]="(confirmPassword?.invalid || signupForm.errors?.['passwordMismatch']) && (confirmPassword?.touched || submitted)"
                                    [class.is-valid]="confirmPassword?.valid && !signupForm.errors?.['passwordMismatch'] && confirmPassword?.touched"
                                    id="confirmPassword" formControlName="confirmPassword"
                                    placeholder="Confirm your password">
                                <button class="btn btn-outline-secondary" type="button"
                                    (click)="toggleConfirmPasswordVisibility()">
                                    @if (showConfirmPassword) {
                                    <!-- Eye slash icon -->
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        viewBox="0 0 16 16">
                                        <path
                                            d="M13.359 11.238C15.06 9.72 16 8 16 8s-3-5.5-8-5.5a7.028 7.028 0 0 0-2.79.588l.77.771A5.944 5.944 0 0 1 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.134 13.134 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755-.165.165-.337.328-.517.486l.708.709z" />
                                        <path
                                            d="M11.297 9.176a3.5 3.5 0 0 0-4.474-4.474l.823.823a2.5 2.5 0 0 1 2.829 2.829l.822.822zm-2.943 1.299.822.822a3.5 3.5 0 0 1-4.474-4.474l.823.823a2.5 2.5 0 0 0 2.829 2.829z" />
                                        <path
                                            d="M3.35 5.47c-.18.16-.353.322-.518.487A13.134 13.134 0 0 0 1.172 8l.195.288c.335.48.83 1.12 1.465 1.755C4.121 11.332 5.881 12.5 8 12.5c.716 0 1.39-.133 2.02-.36l.77.772A7.029 7.029 0 0 1 8 13.5C3 13.5 0 8 0 8s.939-1.721 2.641-3.238l.708.709zm10.296 8.884-12-12 .708-.708 12 12-.708.708z" />
                                    </svg>
                                    } @else {
                                    <!-- Eye icon -->
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        viewBox="0 0 16 16">
                                        <path
                                            d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z" />
                                        <path
                                            d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z" />
                                    </svg>
                                    }
                                </button>
                            </div>
                            <!-- Confirm Password Errors -->
                            @if ((confirmPassword?.invalid || signupForm.errors?.['passwordMismatch']) &&
                            (confirmPassword?.touched || submitted)) {
                            <div class="invalid-feedback">
                                @if (confirmPassword?.errors?.['required']) {
                                <div i18n="confirm password@@signup-form-required-confirm-password-error">Please confirm
                                    your password</div>
                                }
                                @if (signupForm.errors?.['passwordMismatch'] && !confirmPassword?.errors?.['required'])
                                {
                                <div i18n="confirm password no match@@signup-form-confirm-password-no-match-error">
                                    Passwords do not match</div>
                                }
                            </div>
                            }
                        </div>

                        <!-- Submit Button -->
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary"
                                i18n="signup page sign up button@@signup-page-form-button-signup">
                                Sign up
                            </button>
                        </div>

                        <!-- Login Link -->
                        <div class="text-center mt-3">
                            <a routerLink="/login"
                                i18n="signup page already have an account@@signup-form-existing-account">Already have an
                                account? Login</a>
                        </div>
                    </form>

                </div>
            </div>
        </div>
    </div>
</div>